<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solmegle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            background: #008080;
            overflow: hidden;
            height: 100vh;
        }
        
        .desktop {
            width: 100vw;
            height: 100vh;
            background: #008080;
            position: relative;
        }
        
        .desktop-icon {
            position: absolute;
            width: 80px;
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            cursor: pointer;
            padding: 8px;
        }
        
        .desktop-icon:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .icon-image {
            width: 32px;
            height: 32px;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            font-size: 8px;
        }
        
        .icon-label {
            text-align: center;
            font-size: 11px;
            line-height: 12px;
            max-width: 70px;
        }
        
        .window {
            position: absolute;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            min-width: 400px;
            min-height: 300px;
            display: none;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .window.active {
            display: block;
            z-index: 1000;
        }
        
        .window-header {
            background: linear-gradient(90deg, #0000ff 0%, #4080ff 100%);
            color: white;
            padding: 2px 4px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 18px;
            font-size: 11px;
            cursor: move;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .window-control {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 8px;
            font-weight: bold;
            color: #000;
        }
        
        .window-control:active {
            border: 1px inset #c0c0c0;
        }
        
        .window-content {
            padding: 8px;
            height: calc(100% - 18px);
        }
        
        .chat-window {
            width: 500px;
            height: 400px;
            top: 50px;
            left: 100px;
        }
        
        .video-window {
            width: 600px;
            height: 500px;
            top: 80px;
            left: 200px;
        }
        
        .groups-window {
            width: 550px;
            height: 450px;
            top: 110px;
            left: 300px;
        }
        
        .btn {
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            padding: 4px 12px;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
            margin: 2px;
        }
        
        .btn:active {
            border: 1px inset #c0c0c0;
        }
        
        .btn-primary {
            background: #0080ff;
            color: white;
            border: 1px outset #0080ff;
        }
        
        .form-input {
            width: 100%;
            padding: 2px 4px;
            border: 1px inset #c0c0c0;
            background: white;
            font-family: inherit;
            font-size: 11px;
            margin-bottom: 8px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 2px;
            font-weight: bold;
        }
        
        .messages {
            height: 200px;
            border: 1px inset #c0c0c0;
            background: white;
            padding: 8px;
            overflow-y: auto;
            margin-bottom: 8px;
        }
        
        .message {
            margin-bottom: 4px;
            font-size: 11px;
        }
        
        .message-you {
            color: #0000ff;
        }
        
        .message-stranger {
            color: #ff0000;
        }
        
        .message-status {
            color: #008000;
            font-style: italic;
            text-align: center;
            margin: 8px 0;
        }
        
        .input-row {
            display: flex;
            gap: 4px;
        }
        
        .input-row input {
            flex: 1;
            margin-bottom: 0;
        }
        
        .video-container {
            display: flex;
            gap: 8px;
            height: 300px;
        }
        
        .video-feed {
            flex: 1;
            background: #000;
            border: 1px inset #c0c0c0;
            position: relative;
        }
        
        .video-element {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-overlay {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: rgba(192,192,192,0.9);
            padding: 2px 6px;
            font-size: 10px;
        }
        
        .groups-grid {
            height: 300px;
            border: 1px inset #c0c0c0;
            background: white;
            padding: 8px;
            overflow-y: auto;
        }
        
        .group-card {
            border: 1px outset #c0c0c0;
            padding: 8px;
            margin-bottom: 8px;
            background: #f0f0f0;
            cursor: pointer;
        }
        
        .group-card:hover {
            background: #e0e0e0;
        }
        
        .group-card:active {
            border: 1px inset #c0c0c0;
        }
        
        .taskbar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: #c0c0c0;
            border-top: 1px solid #ffffff;
            display: flex;
            align-items: center;
            padding: 2px;
            z-index: 3000;
        }
        
        .start-button {
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            padding: 4px 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 11px;
        }
        
        .start-button:active {
            border: 1px inset #c0c0c0;
        }
        
        .taskbar-time {
            margin-left: auto;
            background: #c0c0c0;
            border: 1px inset #c0c0c0;
            padding: 4px 8px;
            font-size: 11px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-window {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            width: 400px;
            height: 300px;
        }
        
        .tags-container {
            min-height: 40px;
            border: 1px inset #c0c0c0;
            background: white;
            padding: 4px;
            margin-bottom: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .tag {
            background: #0080ff;
            color: white;
            padding: 2px 6px;
            font-size: 10px;
            cursor: pointer;
        }
        
        .twitter-input {
            position: relative;
        }
        
        .twitter-input::before {
            content: '@';
            position: absolute;
            left: 6px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            z-index: 1;
        }
        
        .twitter-input input {
            padding-left: 16px;
        }
    </style>
</head>
<body>
    <div class="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icon" style="top: 20px; left: 20px;" onclick="openChatWindow()">
            <div class="icon-image">CHAT</div>
            <div class="icon-label">Anonymous Chat</div>
        </div>
        
        <div class="desktop-icon" style="top: 120px; left: 20px;" onclick="openVideoWindow()">
            <div class="icon-image">VID</div>
            <div class="icon-label">Video Chat</div>
        </div>
        
        <div class="desktop-icon" style="top: 220px; left: 20px;" onclick="openGroupsWindow()">
            <div class="icon-image">GRP</div>
            <div class="icon-label">Groups</div>
        </div>
        
        <!-- Chat Window -->
        <div class="window chat-window" id="chatWindow">
            <div class="window-header">
                <span>Anonymous Chat - Solmegle</span>
                <div class="window-controls">
                    <div class="window-control" onclick="closeWindow('chatWindow')">X</div>
                </div>
            </div>
            <div class="window-content">
                <div id="chatSetup">
                    <label class="form-label">Add interests (press Enter):</label>
                    <input type="text" class="form-input" id="interestsInput" placeholder="crypto, gaming, music...">
                    <div class="tags-container" id="tagsContainer"></div>
                    
                    <div class="twitter-input">
                        <label class="form-label">Twitter handle (optional):</label>
                        <input type="text" class="form-input" id="twitterInput" placeholder="your_handle">
                    </div>
                    
                    <button class="btn btn-primary" onclick="startChat()">Start Chat</button>
                    <button class="btn" onclick="openVideoWindow()">Video Instead</button>
                </div>
                
                <div id="chatArea" style="display: none;">
                    <div class="messages" id="chatMessages">
                        <div class="message-status">Looking for someone to chat with...</div>
                    </div>
                    <div class="input-row">
                        <button class="btn" onclick="skipChat()">Skip</button>
                        <input type="text" class="form-input" id="messageInput" placeholder="Type a message...">
                        <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Video Window -->
        <div class="window video-window" id="videoWindow">
            <div class="window-header">
                <span>Video Chat - Solmegle</span>
                <div class="window-controls">
                    <div class="window-control" onclick="closeWindow('videoWindow')">X</div>
                </div>
            </div>
            <div class="window-content">
                <div class="video-container">
                    <div class="video-feed">
                        <video class="video-element" id="peerVideo" autoplay playsinline></video>
                        <div class="video-overlay" id="peerOverlay">Stranger</div>
                    </div>
                    <div class="video-feed">
                        <video class="video-element" id="selfVideo" autoplay playsinline muted></video>
                        <div class="video-overlay" id="selfOverlay">You</div>
                    </div>
                </div>
                <div style="margin-top: 8px;">
                    <button class="btn btn-primary" onclick="startVideo()">Start Video</button>
                    <button class="btn" onclick="toggleMute()">Mute</button>
                    <button class="btn" onclick="toggleVideoOff()">Video Off</button>
                    <button class="btn" onclick="skipVideo()">Skip</button>
                </div>
                <div class="messages" id="videoMessages" style="height: 100px; margin-top: 8px;">
                    <div class="message-status">Video chat messages</div>
                </div>
            </div>
        </div>
        
        <!-- Groups Window -->
        <div class="window groups-window" id="groupsWindow">
            <div class="window-header">
                <span>Community Groups - Solmegle</span>
                <div class="window-controls">
                    <div class="window-control" onclick="closeWindow('groupsWindow')">X</div>
                </div>
            </div>
            <div class="window-content">
                <button class="btn btn-primary" onclick="showCreateGroup()">Create Group</button>
                <div class="groups-grid" id="groupsGrid">
                    <div style="text-align: center; padding: 40px; color: #808080;">
                        No groups yet. Create the first one!
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Create Group Modal -->
        <div class="modal" id="createGroupModal">
            <div class="modal-window">
                <div class="window-header">
                    <span>Create Group</span>
                    <div class="window-controls">
                        <div class="window-control" onclick="hideCreateGroup()">X</div>
                    </div>
                </div>
                <div class="window-content">
                    <label class="form-label">Group Name:</label>
                    <input type="text" class="form-input" id="groupName">
                    
                    <label class="form-label">Description:</label>
                    <input type="text" class="form-input" id="groupDesc">
                    
                    <label class="form-label">Token Ticker:</label>
                    <input type="text" class="form-input" id="groupTicker" placeholder="$SOL">
                    
                    <button class="btn btn-primary" onclick="createGroup()">Create</button>
                    <button class="btn" onclick="hideCreateGroup()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Taskbar -->
    <div class="taskbar">
        <div class="start-button">Start</div>
        <div class="taskbar-time" id="taskbarTime">12:00 PM</div>
    </div>

    <script>
        // Global variables
        let allTags = [];
        let twitterHandle = '';
        let chatState = 'setup';
        let videoState = 'setup';
        let groups = [];
        let localStream = null;
        let isMuted = false;
        let isVideoOff = false;

        // Window management
        function openChatWindow() {
            document.getElementById('chatWindow').classList.add('active');
        }

        function openVideoWindow() {
            document.getElementById('videoWindow').classList.add('active');
        }

        function openGroupsWindow() {
            document.getElementById('groupsWindow').classList.add('active');
            loadGroups();
        }

        function closeWindow(windowId) {
            document.getElementById(windowId).classList.remove('active');
            if (windowId === 'videoWindow' && localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
        }

        // Time update
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('taskbarTime').textContent = timeString;
        }
        setInterval(updateTime, 1000);

        // Interest tags
        document.getElementById('interestsInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const value = this.value.trim();
                if (value && !allTags.includes(value)) {
                    allTags.push(value);
                    addTag(value);
                    this.value = '';
                }
            }
        });

        function addTag(text) {
            const container = document.getElementById('tagsContainer');
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = text + ' <span onclick="removeTag(\'' + text + '\', this.parentElement)" style="cursor: pointer;">×</span>';
            container.appendChild(tag);
        }

        function removeTag(text, element) {
            allTags = allTags.filter(tag => tag !== text);
            element.remove();
        }

        // Twitter handle
        document.getElementById('twitterInput').addEventListener('input', function(e) {
            let value = this.value;
            if (value.startsWith('@')) {
                value = value.substring(1);
            }
            twitterHandle = value;
            this.value = value;
        });

        // Chat functionality
        function startChat() {
            chatState = 'searching';
            document.getElementById('chatSetup').style.display = 'none';
            document.getElementById('chatArea').style.display = 'block';
            
            const messages = document.getElementById('chatMessages');
            messages.innerHTML = '<div class="message-status">Looking for someone to chat with...</div>';
            
            setTimeout(() => {
                if (chatState === 'searching') {
                    connectToStranger();
                }
            }, 2000 + Math.random() * 3000);
        }

        function connectToStranger() {
            chatState = 'connected';
            const messages = document.getElementById('chatMessages');
            
            let statusMsg = 'Connected! You are now chatting with a stranger.';
            if (allTags.length > 0) {
                const commonInterest = allTags[Math.floor(Math.random() * allTags.length)];
                statusMsg += ' You both like ' + commonInterest + '.';
            }
            
            messages.innerHTML = '<div class="message-status">' + statusMsg + '</div>';
            
            if (twitterHandle) {
                setTimeout(() => {
                    addChatMessage('system', 'Stranger can see your Twitter: @' + twitterHandle);
                }, 1000);
            }
            
            setTimeout(() => {
                if (chatState === 'connected') {
                    addChatMessage('stranger', 'Hey there! How are you?');
                }
            }, 2000);
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message || chatState !== 'connected') return;
            
            addChatMessage('you', message);
            input.value = '';
            
            setTimeout(() => {
                if (chatState === 'connected') {
                    const responses = ['Cool!', 'Interesting!', 'Nice!', 'Tell me more', 'I see'];
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    addChatMessage('stranger', response);
                }
            }, 1000 + Math.random() * 2000);
        }

        function addChatMessage(sender, message) {
            const messages = document.getElementById('chatMessages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            
            if (sender === 'you') {
                msgDiv.innerHTML = '<span class="message-you">You:</span> ' + message;
            } else if (sender === 'stranger') {
                msgDiv.innerHTML = '<span class="message-stranger">Stranger:</span> ' + message;
            } else {
                msgDiv.innerHTML = '<span style="color: #008000;">' + message + '</span>';
            }
            
            messages.appendChild(msgDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function skipChat() {
            chatState = 'searching';
            const messages = document.getElementById('chatMessages');
            messages.innerHTML = '<div class="message-status">Looking for someone new...</div>';
            
            setTimeout(() => {
                if (chatState === 'searching') {
                    connectToStranger();
                }
            }, 2000 + Math.random() * 3000);
        }

        // Video functionality
        async function startVideo() {
            if (videoState !== 'setup') return;
            
            try {
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                document.getElementById('selfVideo').srcObject = localStream;
                
                if (twitterHandle) {
                    document.getElementById('selfOverlay').textContent = '@' + twitterHandle;
                }
                
                videoState = 'searching';
                
                // Simulate peer video
                setTimeout(() => {
                    if (videoState === 'searching') {
                        connectVideoStranger();
                    }
                }, 2000);
                
            } catch (error) {
                alert('Camera access required for video chat');
            }
        }

        function connectVideoStranger() {
            videoState = 'connected';
            
            // Create fake video stream for demo
            const canvas = document.createElement('canvas');
            canvas.width = 320;
            canvas.height = 240;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#404040';
            ctx.fillRect(0, 0, 320, 240);
            ctx.fillStyle = '#ffffff';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Stranger Video', 160, 120);
            
            const stream = canvas.captureStream();
            document.getElementById('peerVideo').srcObject = stream;
            document.getElementById('peerOverlay').textContent = '@stranger_user';
            
            const messages = document.getElementById('videoMessages');
            messages.innerHTML = '<div class="message-status">Video chat connected!</div>';
        }

        function toggleMute() {
            isMuted = !isMuted;
            if (localStream) {
                localStream.getAudioTracks().forEach(track => {
                    track.enabled = !isMuted;
                });
            }
        }

        function toggleVideoOff() {
            isVideoOff = !isVideoOff;
            if (localStream) {
                localStream.getVideoTracks().forEach(track => {
                    track.enabled = !isVideoOff;
                });
            }
        }

        function skipVideo() {
            videoState = 'searching';
            document.getElementById('peerVideo').srcObject = null;
            document.getElementById('peerOverlay').textContent = 'Stranger';
            
            setTimeout(() => {
                if (videoState === 'searching') {
                    connectVideoStranger();
                }
            }, 2000);
        }

        // Groups functionality
        function showCreateGroup() {
            document.getElementById('createGroupModal').classList.add('active');
        }

        function hideCreateGroup() {
            document.getElementById('createGroupModal').classList.remove('active');
        }

        function createGroup() {
            const name = document.getElementById('groupName').value;
            const desc = document.getElementById('groupDesc').value;
            const ticker = document.getElementById('groupTicker').value;
            
            if (!name) {
                alert('Group name required');
                return;
            }
            
            const group = {
                id: Date.now(),
                name: name,
                description: desc || 'No description',
                ticker: ticker || '$TOKEN',
                members: 1
            };
            
            groups.push(group);
            loadGroups();
            hideCreateGroup();
            
            // Clear form
            document.getElementById('groupName').value = '';
            document.getElementById('groupDesc').value = '';
            document.getElementById('groupTicker').value = '';
        }

        function loadGroups() {
            const grid = document.getElementById('groupsGrid');
            
            if (groups.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #808080;">No groups yet. Create the first one!</div>';
                return;
            }
            
            grid.innerHTML = '';
            groups.forEach(group => {
                const card = document.createElement('div');
                card.className = 'group-card';
                card.onclick = () => joinGroup(group.id);
                
                card.innerHTML = `
                    <strong>${group.name}</strong> ${group.ticker}<br>
                    ${group.description}<br>
                    <small>${group.members} members online</small>
                `;
                
                grid.appendChild(card);
            });
        }

        function joinGroup(groupId) {
            alert('Joining group ' + groupId + ' (demo)');
        }

        // Enter key handlers
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize
        updateTime();
    </script>
</body>
</html>
